var child_process = require('child_process');
var path = require('path');

module.exports = function spawn(/*script[,arg1,arg2..], done*/) {
    var args = Array.prototype.slice.call(arguments);
    var script = args.shift();
    var done = args.pop();

    var _env = JSON.parse(JSON.stringify(process.env));
    _env.NODE_PATH = path.resolve('./node_modules');

    var proc = child_process.fork(script, {
        cwd: path.resolve('.'),
        env: _env
    });

    proc.send(args);

    proc.on('message', function (message) {
        done(message.err, message.result);
        proc.kill();
    });
};
