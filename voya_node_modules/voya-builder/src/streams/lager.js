module.exports = function lager(config, out$) {
    if (config.logStyle === 'generic') {
        return plainLager(config, out$);
    } else {
        return goodLager(config, out$);
    }
};

function goodLager(config, out$) {
    var logLine = 1;
    return function (bundleCfg, done) {
        if (!bundleCfg._logLine) {
            bundleCfg._logLine = ++logLine;
            out$.write('\n');
        }

        var msg = bundleCfg.status + " " + bundleCfg.name;

        // go up from current line to the line this bundle is on
        for (var i = logLine; i >= bundleCfg._logLine; i--) {
            out$.write("\x1b[A\r");
        }
        out$.write(msg);
        // step back down to logline from the bundle's logline
        for (; i < logLine; i++) {
            out$.write("\n\r");
        }
        done(null, bundleCfg);
    }
}

function plainLager(config, out$) {
    return function (bundleCfg, done) {
        out$.write(bundleCfg.status + " " + bundleCfg.name + "\n\r");
        done(null, bundleCfg);
    }
}
